# Lead Filtering Actor

A production-ready Apify Actor that evaluates leads for a branding/web agency by analyzing website quality, branding needs, and brand value alignment using LLM analysis.

## Overview

This actor processes a list of leads and evaluates each one based on:
- **Website Quality Score** (0-100): Assessment of the website's design, functionality, and user experience
- **Branding Need** (LOW/MEDIUM/HIGH): Level of branding improvement needed
- **Online Presence Score** (0-100): Evaluation of social media presence and digital footprint
- **Brand Value Match** (LOW/MEDIUM/HIGH): Alignment with agency values (storytelling, long-term brand building vs. cheap/fast solutions)
- **W6H Analysis**: Who, What, Where, When, Why, How, How Much
- **Qualification Status**: Boolean indicating if the lead is a good fit
- **Reasons**: List of explanations for the decision

## Setup

### Prerequisites

- Python 3.9+
- Apify account and CLI (for local development)
- OpenAI API key

### Installation

1. Clone or download this repository
2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Set environment variable:
```bash
export OPENAI_API_KEY=your-api-key-here
```

On Windows PowerShell:
```powershell
$env:OPENAI_API_KEY="your-api-key-here"
```

## Running Locally

### Using Apify CLI

```bash
apify run
```

### Using Python directly

```bash
python -m src.main
```

## Input Format

```json
{
  "leads": [
    {
      "company_name": "Example Corp",
      "website_url": "https://example.com",
      "industry": "Technology",
      "location": "San Francisco, CA",
      "social_links": ["https://twitter.com/example", "https://linkedin.com/company/example"],
      "homepage_text": "We provide innovative solutions...",
      "about_text": "Founded in 2020, we are..."
    }
  ],
  "openai_model": "gpt-4o-mini"
}
```

## Output Format

Each lead evaluation is pushed as a separate dataset item:

```json
{
  "company_name": "Example Corp",
  "website_url": "https://example.com",
  "website_quality_score": 75,
  "branding_need": "MEDIUM",
  "online_presence_score": 60,
  "brand_value_match": "HIGH",
  "w6h": {
    "who": "Technology companies",
    "what": "Innovative software solutions",
    "where": "San Francisco, CA",
    "when": "Founded in 2020",
    "why": "To solve complex business problems",
    "how": "Through cutting-edge technology",
    "how_much": "Enterprise pricing"
  },
  "qualified": true,
  "reasons": [
    "Strong brand value alignment with storytelling focus",
    "Website has room for improvement",
    "Good potential for long-term partnership"
  ]
}
```

## Error Handling

If an error occurs during evaluation (LLM failure, invalid JSON, etc.), the actor will:
1. Log the error using `Actor.log.error()`
2. Push a record with `qualified: false` and an `error` field containing the error message

## Deployment to Apify

1. Push your code to GitHub
2. In Apify Console, go to Actors → Create new
3. Select "Import from GitHub"
4. Provide your repository URL
5. Configure environment variables (OPENAI_API_KEY)
6. Test and publish

## Project Structure

```
.
├── apify.json          # Actor configuration
├── requirements.txt    # Python dependencies
├── README.md          # This file
├── Dockerfile         # Docker configuration (auto-generated by Apify)
└── src/
    ├── main.py        # Entry point with async main()
    ├── models.py      # Pydantic models for validation
    ├── llm_client.py  # LLM API client and prompt construction
    └── config.py      # Configuration and environment variables
```

## License

MIT

